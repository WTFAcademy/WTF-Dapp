æœ¬èŠ‚ä½œè€…ï¼š[@æ„šæŒ‡å¯¼](https://x.com/yudao1024)ã€[@å°ç¬¦](https://x.com/smallfu666)

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä¼šå¼•å¯¼ä½ å¿«é€Ÿåˆ›å»ºä¸€ä¸ª React é¡¹ç›®ï¼Œå¹¶åœ¨å…¶ä¸­å±•ç¤ºä¸€ä¸ª NFT çš„å›¾ç‰‡ã€‚

---

è¯¥è¯¾ç¨‹ä¸»è¦é¢å‘æœ‰ä¸€å®šå‰ç«¯å¼€å‘åŸºç¡€çš„åŒå­¦ï¼Œå¸®åŠ©ä½ ä» Web2 è¿ˆå‘ Web3ï¼Œè·å¾— DAppï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰çš„ç ”å‘èƒ½åŠ›ã€‚

è¯¾ç¨‹ä¼šåŸºäº [Ant Design Web3](https://web3.ant.design/) æ¥è¿›è¡Œè®²è§£ï¼Œè®©ä½ å¯ä»¥æ›´è½»æ˜“çš„ä¸Šæ‰‹ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸ä¼šå½±å“ä½ å¯¹åŸºç¡€æ¦‚å¿µçš„ç†è§£ï¼Œæˆ‘ä»¬ä¼šåœ¨è¯¾ç¨‹ä¸­å¯¹ç›¸å…³æ¦‚å¿µè¿›è¡Œè®²è§£ï¼Œç¡®ä¿è¯¾ç¨‹å®Œæˆåä½ å¯ä»¥æŒæ¡ DApp ç ”å‘çš„åŸºç¡€çŸ¥è¯†ã€‚

è¯¥è¯¾ç¨‹æœ‰ä¸€å®šçš„å‰ç½®è¦æ±‚ï¼Œè¦æ±‚ä½ å¯¹ [React](https://react.dev/) å‰ç«¯å¼€å‘æœ‰åŸºç¡€çš„äº†è§£ï¼Œå¦‚æœä½ å¯¹ React ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆå­¦ä¹  [React å®˜æ–¹æ–‡æ¡£](https://react.dev/learn)ã€‚

## åˆå§‹åŒ–ä¸€ä¸ª React é¡¹ç›®

æˆ‘ä»¬å°†åŸºäº [React](https://react.dev/) + [Next.js](https://nextjs.org/) + [TypeScript](https://www.typescriptlang.org/) æ¥åˆå§‹åŒ–æˆ‘ä»¬çš„é¡¹ç›®ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æ›´ç†Ÿæ‚‰ [umi](https://umijs.org/) ç­‰å…¶å®ƒå‰ç«¯æ¡†æ¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„æ¡†æ¶ã€‚ä½ ä¾ç„¶å¯ä»¥å‚è€ƒè¯¥æ•™ç¨‹ï¼Œä¸è¿‡å¯¹äºéä¸“ä¸šçš„å‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬å»ºè®®ä¸€æ­¥æ­¥æŒ‰ç…§æˆ‘ä»¬çš„æ•™ç¨‹æ¥å®Œæˆï¼Œé¿å…é‡åˆ°ä¸€äº›æ¡†æ¶å·®å¼‚å¯¼è‡´çš„é—®é¢˜ã€‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å…ˆç¡®ä¿ä½ å®‰è£…äº† [Node.js](https://nodejs.org/)ï¼Œå¹¶ä¸”ç‰ˆæœ¬å¤§äº 20.0.0ã€‚æ•™ç¨‹ä¼šåŸºäºæœ€æ–°çš„ Node.js ç‰ˆæœ¬æ¥ç¼–å†™ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬çš„ Node.jsï¼Œå¯èƒ½ä¹Ÿèƒ½è¿è¡Œï¼Œä½†æ˜¯å½“ä½ é‡åˆ°é—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•å‡çº§ Node.js ç‰ˆæœ¬ã€‚

å®‰è£…å®Œæˆåä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ£€æŸ¥ Node.js å’Œå®ƒè‡ªå¸¦çš„ `npm` å’Œ `npx` æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```bash
node -v # => v20.0.0+
npm -v # => 10.0.0+
npx -v # => 10.0.0+
```

æ¥ä¸‹æ¥æˆ‘ä»¬å‚è€ƒ [Next.js å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs/getting-started/installation)ï¼Œæ¥åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼š

```bash
npx create-next-app@14.0.4 # æˆ‘ä»¬æŒ‡å®š create-next-app çš„ç‰ˆæœ¬ä¸º 14.0.4ï¼Œé¿å…å‡çº§å¸¦æ¥çš„å·®å¼‚å½±å“æ•™ç¨‹çš„ç»†èŠ‚
```

è¯·æŒ‰ç…§æç¤ºåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°†å…¶å‘½åä¸º `ant-design-web3-demo`ï¼Œå…·ä½“çš„æŠ€æœ¯æ ˆé€‰æ‹©ä½ å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š

![åˆ›å»ºé¡¹ç›®](./img/init-next.png)

æˆ‘ä»¬å»æ‰äº† `Tailwind CSS` å’Œ `App Router` çš„é€‰æ‹©ï¼Œè®©é¡¹ç›®å˜å¾—æ›´ç®€å•ï¼Œå®é™…é¡¹ç›®ä¸­ä½ åº”è¯¥æŒ‰ç…§ä½ çš„éœ€æ±‚é€‰æ‹©éœ€è¦çš„å†…å®¹ã€‚

## å®‰è£…ä¾èµ–å¹¶å¯åŠ¨é¡¹ç›®

åˆ›å»ºå®Œæˆä¹‹åè¿›å…¥é¡¹ç›®ç›®å½•å®‰è£…ä¾èµ–ï¼š

```base
cd ant-design-web3-demo
npm i
```

å®‰è£…å®Œæˆåæ‰§è¡Œ `npm run dev` å¯åŠ¨é¡¹ç›®ï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:3000` æ¥æŸ¥çœ‹é¡¹ç›®æ˜¯å¦å¯åŠ¨æˆåŠŸã€‚

![](./img/next-init-page.png)

## æ·»åŠ  Ant Design Web3

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®‰è£… [Ant Design](https://ant.design/) å’Œ [Ant Design Web3](https://web3.ant.design/) çš„åŸºç¡€ç»„ä»¶ä»¥åŠå…¶å®ƒä¾èµ–åˆ°é¡¹ç›®ä¸­ï¼š

```bash
npm i antd @ant-design/web3 @ant-design/web3-wagmi wagmi @tanstack/react-query --save
```

- `@ant-design/web3` æ˜¯ä¸€ä¸ª UI ç»„ä»¶åº“ï¼Œå®ƒé€šè¿‡ä¸åŒçš„[é€‚é…å™¨](https://web3.ant.design/guide/adapter-cn)å’Œä¸åŒçš„åŒºå—é“¾è¿æ¥ã€‚æœ¬è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦åŸºäºçš„æ˜¯[ä»¥å¤ªåŠ](https://ethereum.org/zh/)ä¸Šçš„ DApp å¼€å‘ã€‚

- `@ant-design/web3-wagmi` æ˜¯ä¸€ä¸ªåŸºäº[wagmi 2.x](https://wagmi.sh/) çš„ Ant Design Web3 ä»¥å¤ªåŠé€‚é…å™¨ï¼Œå®ƒä¸º `@ant-design/web3` çš„ç»„ä»¶æä¾›äº†è¿æ¥ä»¥å¤ªåŠç­‰ EVM å…¼å®¹é“¾çš„èƒ½åŠ›ã€‚é€šè¿‡å®ƒï¼Œä½ ä¸éœ€è¦è‡ªå·±å¤„ç†ç»„ä»¶çš„è¿æ¥çŠ¶æ€ï¼Œé“¾æ•°æ®è¯·æ±‚ç­‰é€»è¾‘ã€‚å®ƒä¼šé€šè¿‡ [Web3ConfigProvider](https://web3.ant.design/components/web3-config-provider-cn] ä¸ºç»„ä»¶æä¾›ç›¸å…³å…¨å±€çŠ¶æ€å’Œæ¥å£ã€‚

- [wagmi](https://wagmi.sh/) æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡ä»¥å¤ªåŠçš„ React Hooks åº“ï¼Œå¹¶ä¾èµ– `@tanstack/react-query`ã€‚Ant Design Web3 çš„é€‚é…å™¨ `@ant-design/web3-wagmi` å°±æ˜¯åŸºäºå®ƒå®ç°çš„ï¼Œåœ¨æœ¬è¯¾ç¨‹çš„åé¢éƒ¨åˆ†ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œé‚£æåˆ°çš„é€‚é…å™¨å°±æ˜¯æŒ‡ `@ant-design/web3-wagmi`ã€‚

å®‰è£…å®Œæˆåï¼Œå› ä¸º Next.js å½“å‰ç‰ˆæœ¬[å·²æœ‰çš„ä¸€ä¸ªé—®é¢˜](https://github.com/ant-design/ant-design/issues/46053)ï¼Œä½ éœ€è¦åœ¨ `next.config.js` ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```diff
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
+ transpilePackages: [  "@ant-design", "antd", "rc-util", "rc-pagination", "rc-picker", "rc-input" ],
}

module.exports = nextConfig
```

å®‰è£…å®Œæˆåï¼Œæ–°å»º `pages/web3.tsx` çš„æ–‡ä»¶ï¼Œå¡«å……å†…å®¹å¦‚ä¸‹ï¼š

```tsx | pure
import { Address } from "@ant-design/web3";

export default function Web3() {
  return (
    <Address format address="0xEcd0D12E21805803f70de03B72B1C162dB0898d9" />
  );
}
```

ç„¶åè®¿é—® [http://localhost:3000/web3](http://localhost:3000/web3) å¯ä»¥çœ‹åˆ°ä½ å·²ç»åœ¨é¡¹ç›®ä¸­æˆåŠŸä½¿ç”¨ Ant Design Web3 äº† ğŸ‰

![](./img/dev-success.png)

ä¸ºäº†è®©é¡µé¢æ›´ç¾è§‚ï¼Œé¿å…ä¸Šå›¾ä¸­çš„æ¨ªæ¡æ ·å¼ï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­çš„ `styles/global.css` çš„ç¬¬`85`è¡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```diff
html,
body {
  max-width: 100vw;
+  min-height: 100vh;
  overflow-x: hidden;
}
```

å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚

## é…ç½®é€‚é…å™¨

é€‚é…å™¨å¯ä»¥è®© Ant Design Web3 çš„ UI ç»„ä»¶å¿«é€Ÿè¿æ¥ä¸ŠåŒºå—é“¾ã€‚æ¯”å¦‚ï¼Œå½“ä½ ä½¿ç”¨äº† `@ant-design/web3-wagmi` åï¼ŒConnectorã€NFTCard ç­‰ç»„ä»¶å°±å¯ä»¥ç›´æ¥è¿æ¥ä¸Šä»¥å¤ªåŠäº†ã€‚ é€‚é…å™¨çš„é…ç½®å¯ä»¥å‚è€ƒ[ä»¥å¤ªåŠæ¨èé…ç½®](https://web3.ant.design/components/ethereum-cn#%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE)ï¼Œåœ¨è¯¥è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå…ˆé‡‡ç”¨æœ€ç®€å•çš„é…ç½®ï¼Œå†é€æ­¥å¼•å¯¼ä½ äº†è§£ä½ å®é™…é¡¹ç›®ä¸­æ‰€éœ€è¦çš„é…ç½®ã€‚

é¦–å…ˆï¼Œè¯·ç»§ç»­ç¼–è¾‘ `pages/web3.tsx` æ–‡ä»¶ï¼Œå¼•å…¥æ‰€éœ€è¦çš„å†…å®¹ï¼š

```diff
+ import { http } from "wagmi";
+ import { Mainnet, WagmiWeb3ConfigProvider } from '@ant-design/web3-wagmi';
import { Address } from "@ant-design/web3";

export default function Web3() {
  return (
    <Address format address="0xEcd0D12E21805803f70de03B72B1C162dB0898d9" />
  );
};
```

å…¶ä¸­å¼•å…¥çš„å†…å®¹è¯´æ˜å¦‚ä¸‹ï¼š

- httpï¼šwagmi ç”¨æ¥åˆ›å»º [HTTP JSON RPC](https://wagmi.sh/core/api/transports/http) è¿æ¥çš„æ–¹æ³•ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚è®¿é—®åŒºå—é“¾ã€‚
- Mainnetï¼šä»£è¡¨ä»¥å¤ªåŠä¸»ç½‘ï¼Œé™¤äº† `Mainnet` ä»¥å¤–è¿˜æ”¯æŒ `Sepolia` æµ‹è¯•ç½‘ä»¥åŠ `BSC` å’Œ `Arbitrum` ç­‰å¤šä¸ªé“¾ï¼›æ”¯æŒçš„é“¾å‚è€ƒ[è¿™é‡Œ](https://github.com/ant-design/ant-design-web3/blob/main/packages/wagmi/src/chains.ts)ã€‚
- [WagmiWeb3ConfigProvider](https://web3.ant.design/components/web3-config-provider-cn)ï¼šAnt Design Web3 ç”¨æ¥æ¥æ”¶ wagmi é…ç½®çš„ Providerã€‚

æ¥ç€åˆ›å»ºé…ç½®ï¼š

```diff
import { http } from "wagmi";
import { Mainnet, WagmiWeb3ConfigProvider } from '@ant-design/web3-wagmi';
import { Address } from "@ant-design/web3";

export default function Web3() {
  return (
+    <WagmiWeb3ConfigProvider
+      chains={[Mainnet]}
+      transports={{
+        [Mainnet.id]: http(),
+      }}
+    >
      <Address format address="0xEcd0D12E21805803f70de03B72B1C162dB0898d9" />
+    </WagmiWeb3ConfigProvider>
  );
};

```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†é€‚é…å™¨çš„é…ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Ant Design Web3 çš„ç»„ä»¶æ¥è·å–é“¾ä¸Šçš„æ•°æ®äº†ã€‚

æˆ‘ä»¬è¯•ä¸€è¯•ä½¿ç”¨ [NFTCard](https://web3.ant.design/components/nft-card-cn) ç»„ä»¶ï¼š

```diff
import { http } from "wagmi";
import { Mainnet, WagmiWeb3ConfigProvider } from '@ant-design/web3-wagmi';
- import { Address } from "@ant-design/web3";
+ import { Address, NFTCard } from "@ant-design/web3";

export default function Web3() {
  return (
    <WagmiWeb3ConfigProvider
      chains={[Mainnet]}
      transports={{
        [Mainnet.id]: http(),
      }}
    >
      <Address format address="0xEcd0D12E21805803f70de03B72B1C162dB0898d9" />
+     <NFTCard
+       address="0xEcd0D12E21805803f70de03B72B1C162dB0898d9"
+       tokenId={641}
+     />
    </WagmiWeb3ConfigProvider>
  );
};
```

`NFTCard` ç»„ä»¶ä¼šä» [0xEcd0D12E21805803f70de03B72B1C162dB0898d9](https://etherscan.io/address/0xEcd0D12E21805803f70de03B72B1C162dB0898d9) NFT åˆçº¦ä¸­è·å– tokenId ä¸º `641` çš„ NFT ä¿¡æ¯ï¼Œç„¶åå±•ç¤ºåœ¨é¡µé¢ä¸Šã€‚

æ•ˆæœå¦‚ä¸‹ï¼š

![](./img/nft-card.png)

å¦‚æœæ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œé‚£ä¹ˆè¯·æ£€æŸ¥ä½ çš„ç½‘ç»œæ˜¯å¦æ­£å¸¸ã€‚å¦‚æœèƒ½å¤Ÿæ­£å¸¸æ¸²æŸ“å‡º NFT å›¾ç‰‡ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œè¿™ä¸€è®²æˆ‘ä»¬å°±å®Œæˆäº†ï¼
